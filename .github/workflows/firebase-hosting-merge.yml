# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase on merge

on:
  push:
    branches:
      - "fix/firebase_deploys"
      - "develop"
      - "master"

jobs:
  staging-deploy:
    runs-on: ubuntu-latest
    if: github.ref_name == 'develop'
    steps:
      - run: echo "github.ref_name - ${{ github.ref_name }}"
      - run: echo "github.ref - ${{ github.ref }}"
      # - name: Installing dependencys
      #   uses: actions/checkout@master
      # - name: Setup Node JS
      #   uses: actions/setup-node@master
      #   with:
      #     node-version: "14.18.0"
      # - run: npm install --dotenv-extended
      # - name: Loading environment configurations
      # - run: node create_env.js
      #   env:
      #     ENVIRONMENT_CONTENT: "${{ secrets.STAGING_ENVIRONMENT }}"
      #     ENVIRONMENT: "stg"
      # - uses: actions/checkout@v2
      # - run: npm ci && npm run build-hml
      # - uses: FirebaseExtended/action-hosting-deploy@v0
      #   with:
      #     repoToken: "${{ secrets.GITHUB_TOKEN }}"
      #     firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT_FINANCIAL_MANAGER_STAGING }}"
      #     channelId: live
      #     projectId: financial-manager-staging

  production-deploy:
    runs-on: ubuntu-latest
    if: github.ref_name == 'main'
    steps:
      - run: echo "github.ref_name - ${{ github.ref_name }}"
      - run: echo "github.ref - ${{ github.ref }}"
      # - uses: actions/checkout@master
      # - uses: actions/setup-node@master
      #   with:
      #     node-version: "14.18.0"
      # - run: npm install --dotenv-extended
      # - name: Loading environment configurations
      # - run: node create_env.js
      #   env:
      #     ENVIRONMENT_CONTENT: "${{ secrets.PRODUCTION_ENVIRONMENT }}"
      #     ENVIRONMENT: "prd"
      # - uses: actions/checkout@v2
      # - run: npm ci && npm run build-prd
      # - uses: FirebaseExtended/action-hosting-deploy@v0
      #   with:
      #     repoToken: "${{ secrets.GITHUB_TOKEN }}"
      #     firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT_FINANCIAL_MANAGER_STAGING }}"
      #     channelId: live
      #     projectId: financials-manager

  hotfix-deploy:
    runs-on: ubuntu-latest
    if: github.ref_name == 'fix/firebase_deploys'
    steps:
      - name: 1. Checking branch name
        run: echo Running on branch ${GITHUB_REF##*/}
      - name: 2. Installing dependencys
        uses: actions/checkout@master
      - name: 3. Setup Node JS
        uses: actions/setup-node@master
        with:
          node-version: "14.18.0"
      - name: 4. Installing dotenv package
        run: npm install --dotenv-extended
      - name: 5. Loading environment configurations
        run: node create_env.js
        env:
          ENVIRONMENT_CONTENT: "${{ secrets.STAGING_ENVIRONMENT }}"
          ENVIRONMENT: "stg"
      - name: 6. Building project for stagging environment
        uses: actions/checkout@v2
        run: npm ci && npm run build-hml
      - name: 7. Defining firebase configurations
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: "${{ secrets.GITHUB_TOKEN }}"
          firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT_FINANCIAL_MANAGER_STAGING }}"
          channelId: live
          projectId: financial-manager-staging
